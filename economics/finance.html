<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>经济数据</title>
    <!-- 引入Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- 引入Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- 自定义CSS -->
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background: #f4f6f9;
            color: #333;
        }

        .nav-tabs .nav-link {
            background: #fff;
            border: 1px solid #dee2e6;
            border-bottom: none;
            color: #495057;
            transition: background-color 0.3s;
        }

        .nav-tabs .nav-link.active {
            background: #e9ecef;
            font-weight: 600;
        }

        .tab-content {
            border: 1px solid #dee2e6;
            padding: 20px;
            background: #fff;
        }

        .symbol-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            border-bottom: 1px solid #f1f1f1;
            align-items: center;
            transition: background-color 0.3s;
        }

        .symbol-item:hover {
            background-color: #f9f9f9;
        }

        .symbol-name {
            font-weight: 500;
        }

        .symbol-value {
            font-size: 0.9em;
        }

        @media (max-width: 576px) {
            .symbol-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .symbol-value {
                margin-top: 5px;
            }
        }
    </style>
</head>

<body>
    <div class="container my-5">
        <!-- TAB导航 -->
        <ul class="nav nav-tabs" id="sectorTabs" role="tablist">
            <!-- 动态生成TAB -->
        </ul>
        <!-- TAB内容 -->
        <div class="tab-content" id="sectorTabsContent">
            <!-- 动态生成内容 -->
        </div>
    </div>

    <!-- 引入Bootstrap JS和依赖 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- 自定义JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sectorTabs = document.getElementById('sectorTabs');
            const sectorTabsContent = document.getElementById('sectorTabsContent');
            const DEFAULT_ACTIVE_TAB = 'Indices';  // 设置默认激活的 TAB

            fetch('sectors_panel.json')
                .then(response => response.json())
                .then(sectorsData => {
                    fetch('compare_all.txt')
                        .then(response => response.text())
                        .then(txtData => {
                            const compareMap = {};
                            txtData.split('\n').forEach(line => {
                                const [key, value] = line.split(':').map(item => item.trim());
                                if (key && value !== undefined) {
                                    compareMap[key] = value;
                                }
                            });

                            const sectors = Object.keys(sectorsData);
                            let activeTabSet = false;
                            let defaultTabExists = false;

                            sectors.forEach((sector, index) => {
                                const symbolsObj = sectorsData[sector];
                                const symbols = Object.keys(symbolsObj);

                                // 检查这个板块是否有有效的symbol
                                const validSymbols = symbols.filter(symbol => compareMap.hasOwnProperty(symbol));

                                if (validSymbols.length > 0) {
                                    const isDefaultTab = sector === DEFAULT_ACTIVE_TAB;
                                    if (isDefaultTab) defaultTabExists = true;

                                    const tab = document.createElement('li');
                                    tab.className = 'nav-item';
                                    const tabButton = document.createElement('button');
                                    tabButton.className = `nav-link ${isDefaultTab ? 'active' : ''}`;
                                    tabButton.id = `${sector}-tab`;
                                    tabButton.setAttribute('data-bs-toggle', 'tab');
                                    tabButton.setAttribute('data-bs-target', `#${sector}`);
                                    tabButton.setAttribute('type', 'button');
                                    tabButton.setAttribute('role', 'tab');
                                    tabButton.setAttribute('aria-controls', sector);
                                    tabButton.setAttribute('aria-selected', isDefaultTab ? 'true' : 'false');
                                    tabButton.textContent = sector.replace(/_/g, ' ');
                                    tab.appendChild(tabButton);
                                    sectorTabs.appendChild(tab);

                                    // 创建TAB内容
                                    const tabPane = document.createElement('div');
                                    tabPane.className = `tab-pane fade ${isDefaultTab ? 'show active' : ''}`;
                                    tabPane.id = sector;
                                    tabPane.setAttribute('role', 'tabpanel');
                                    tabPane.setAttribute('aria-labelledby', `${sector}-tab`);

                                    validSymbols.forEach(symbol => {
                                        const symbolValue = compareMap[symbol];
                                        const symbolDisplayName = symbolsObj[symbol] || symbol;

                                        const symbolItem = document.createElement('div');
                                        symbolItem.className = 'symbol-item';

                                        const nameDiv = document.createElement('div');
                                        nameDiv.className = 'symbol-name';
                                        nameDiv.textContent = symbolDisplayName;

                                        const valueDiv = document.createElement('div');
                                        valueDiv.className = 'symbol-value';
                                        valueDiv.textContent = symbolValue;

                                        if (symbolValue.includes('+')) {
                                            valueDiv.style.color = '#28a745';
                                        } else if (symbolValue.includes('-')) {
                                            valueDiv.style.color = '#dc3545';
                                        } else {
                                            valueDiv.style.color = '#6c757d';
                                        }

                                        symbolItem.appendChild(nameDiv);
                                        symbolItem.appendChild(valueDiv);
                                        tabPane.appendChild(symbolItem);
                                    });

                                    sectorTabsContent.appendChild(tabPane);

                                    if (!activeTabSet && !isDefaultTab) {
                                        activeTabSet = true;
                                    }
                                }
                            });

                            // 如果默认 TAB 不存在或没有有效数据，激活第一个 TAB
                            if (!defaultTabExists && !activeTabSet) {
                                const firstTab = sectorTabs.querySelector('.nav-link');
                                const firstTabPane = sectorTabsContent.querySelector('.tab-pane');
                                if (firstTab && firstTabPane) {
                                    firstTab.classList.add('active');
                                    firstTab.setAttribute('aria-selected', 'true');
                                    firstTabPane.classList.add('show', 'active');
                                } else {
                                    sectorTabsContent.innerHTML = '<p class="text-info">暂无可用数据。</p>';
                                }
                            }
                        })
                        .catch(err => {
                            console.error('读取 compare_all.txt 文件时出错:', err);
                            sectorTabsContent.innerHTML = '<p class="text-danger">无法加载数据文件。</p>';
                        });
                })
                .catch(err => {
                    console.error('读取 sectors_panel.json 文件时出错:', err);
                    sectorTabsContent.innerHTML = '<p class="text-danger">无法加载板块数据。</p>';
                });
        });
    </script>
</body>

</html>